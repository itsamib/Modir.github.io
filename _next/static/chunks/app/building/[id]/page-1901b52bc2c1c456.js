(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[787],{3014:(e,t,a)=>{Promise.resolve().then(a.bind(a,8135)),Promise.resolve().then(a.bind(a,7911))},8135:(e,t,a)=>{"use strict";a.d(t,{BuildingDashboard:()=>eq});var s=a(5155),n=a(2115),l=a(1090),r=a(704),i=a(9434);let d=r.bL,c=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(r.B8,{ref:t,className:(0,i.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",a),...n})});c.displayName=r.B8.displayName;let o=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(r.l9,{ref:t,className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",a),...n})});o.displayName=r.l9.displayName;let x=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(r.UC,{ref:t,className:(0,i.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),...n})});x.displayName=r.UC.displayName;var m=a(285),u=a(6695);let p=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("div",{className:"relative w-full overflow-auto",children:(0,s.jsx)("table",{ref:t,className:(0,i.cn)("w-full caption-bottom text-sm",a),...n})})});p.displayName="Table";let h=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("thead",{ref:t,className:(0,i.cn)("[&_tr]:border-b",a),...n})});h.displayName="TableHeader";let f=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("tbody",{ref:t,className:(0,i.cn)("[&_tr:last-child]:border-0",a),...n})});f.displayName="TableBody",n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("tfoot",{ref:t,className:(0,i.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...n})}).displayName="TableFooter";let g=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("tr",{ref:t,className:(0,i.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...n})});g.displayName="TableRow";let j=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("th",{ref:t,className:(0,i.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...n})});j.displayName="TableHead";let b=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("td",{ref:t,className:(0,i.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...n})});b.displayName="TableCell",n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("caption",{ref:t,className:(0,i.cn)("mt-4 text-sm text-muted-foreground",a),...n})}).displayName="TableCaption";var N=a(9384),v=a(7804),y=a(286),w=a(8763),T=a(7223),D=a(4301),A=a(1920),C=a(6950),k=a(7787),E=a(4165),_=a(2523),S=a(5057),M=a(4582),U=a(9556),F=a(7381),P=a(518);let R=M.bL;M.YJ;let B=M.WT,J=n.forwardRef((e,t)=>{let{className:a,children:n,...l}=e;return(0,s.jsxs)(M.l9,{ref:t,className:(0,i.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...l,children:[n,(0,s.jsx)(M.In,{asChild:!0,children:(0,s.jsx)(U.A,{className:"h-4 w-4 opacity-50"})})]})});J.displayName=M.l9.displayName;let z=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(M.PP,{ref:t,className:(0,i.cn)("flex cursor-default items-center justify-center py-1",a),...n,children:(0,s.jsx)(F.A,{className:"h-4 w-4"})})});z.displayName=M.PP.displayName;let L=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(M.wn,{ref:t,className:(0,i.cn)("flex cursor-default items-center justify-center py-1",a),...n,children:(0,s.jsx)(U.A,{className:"h-4 w-4"})})});L.displayName=M.wn.displayName;let O=n.forwardRef((e,t)=>{let{className:a,children:n,position:l="popper",...r}=e;return(0,s.jsx)(M.ZL,{children:(0,s.jsxs)(M.UC,{ref:t,className:(0,i.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:l,...r,children:[(0,s.jsx)(z,{}),(0,s.jsx)(M.LM,{className:(0,i.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:n}),(0,s.jsx)(L,{})]})})});O.displayName=M.UC.displayName,n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(M.JU,{ref:t,className:(0,i.cn)("py-1.5 ltr:pl-8 rtl:pr-8 ltr:pr-2 rtl:pl-2 text-sm font-semibold",a),...n})}).displayName=M.JU.displayName;let I=n.forwardRef((e,t)=>{let{className:a,children:n,...l}=e;return(0,s.jsxs)(M.q7,{ref:t,className:(0,i.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 ltr:pl-8 rtl:pr-8 ltr:pr-2 rtl:pl-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...l,children:[(0,s.jsx)("span",{className:"absolute ltr:left-2 rtl:right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(M.VF,{children:(0,s.jsx)(P.A,{className:"h-4 w-4"})})}),(0,s.jsx)(M.p4,{children:n})]})});I.displayName=M.q7.displayName,n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(M.wv,{ref:t,className:(0,i.cn)("-mx-1 my-1 h-px bg-muted",a),...n})}).displayName=M.wv.displayName;var Z=a(6981);let W=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(Z.bL,{ref:t,className:(0,i.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...n,children:(0,s.jsx)(Z.C1,{className:(0,i.cn)("flex items-center justify-center text-current"),children:(0,s.jsx)(P.A,{className:"h-4 w-4"})})})});W.displayName=Z.bL.displayName;var V=a(333),$=a(547);let q=$.bL,Y=$.l9,G=n.forwardRef((e,t)=>{let{className:a,align:n="center",sideOffset:l=4,...r}=e;return(0,s.jsx)($.ZL,{children:(0,s.jsx)($.UC,{ref:t,align:n,sideOffset:l,className:(0,i.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})})});G.displayName=$.UC.displayName;var H=a(3158),K=a(965),Q=a(1178),X=a(3453);function ee(e){let{className:t,classNames:a,showOutsideDays:n=!0,locale:l,...r}=e,d=l===X.A;return(0,s.jsx)(Q.hv,{locale:l,dir:d?"rtl":"ltr",showOutsideDays:n,className:(0,i.cn)("p-2",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-2",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,i.cn)((0,m.r)({variant:"outline"}),"h-6 w-6 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute right-1 rtl:left-1 rtl:right-auto",nav_button_next:"absolute left-1 rtl:right-1 rtl:left-auto",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]",row:"flex w-full mt-1.5",cell:"h-8 w-8 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,i.cn)((0,m.r)({variant:"ghost"}),"h-8 w-8 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{className:t,...a}=e,n=d?H.A:K.A;return(0,s.jsx)(n,{className:(0,i.cn)("h-4 w-4",t),...a})},IconRight:e=>{let{className:t,...a}=e,n=d?K.A:H.A;return(0,s.jsx)(n,{className:(0,i.cn)("h-4 w-4",t),...a})}},...r})}ee.displayName="Calendar";var et=a(527),ea=a(2778),es=a(4059),en=a(154);let el=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(es.bL,{className:(0,i.cn)("grid gap-2",a),...n,ref:t})});el.displayName=es.bL.displayName;let er=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(es.q7,{ref:t,className:(0,i.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),...n,children:(0,s.jsx)(es.C1,{className:"flex items-center justify-center",children:(0,s.jsx)(en.A,{className:"h-2.5 w-2.5 fill-current text-current"})})})});er.displayName=es.q7.displayName;var ei=a(7489);let ed=n.forwardRef((e,t)=>{let{className:a,orientation:n="horizontal",decorative:l=!0,...r}=e;return(0,s.jsx)(ei.b,{ref:t,decorative:l,orientation:n,className:(0,i.cn)("shrink-0 bg-border","horizontal"===n?"h-[1px] w-full":"h-full w-[1px]",a),...r})});ed.displayName=ei.b.displayName;var ec=a(2144);function eo(e){let{isOpen:t,onClose:a,onSave:l,units:r,expense:d}=e,{t:c,language:o,direction:x}=(0,ec.o)(),u=(0,n.useMemo)(()=>[{value:"monthly_charge",key:"addExpenseDialog.categories.monthly_charge",label:c("addExpenseDialog.categories.monthly_charge")},{value:"water_bill",key:"addExpenseDialog.categories.water_bill",label:c("addExpenseDialog.categories.water_bill")},{value:"electricity_bill",key:"addExpenseDialog.categories.electricity_bill",label:c("addExpenseDialog.categories.electricity_bill")},{value:"gas_bill",key:"addExpenseDialog.categories.gas_bill",label:c("addExpenseDialog.categories.gas_bill")},{value:"cleaning",key:"addExpenseDialog.categories.cleaning",label:c("addExpenseDialog.categories.cleaning")},{value:"repairs",key:"addExpenseDialog.categories.repairs",label:c("addExpenseDialog.categories.repairs")},{value:"other",key:"addExpenseDialog.categories.other",label:c("addExpenseDialog.categories.other")}],[c]),[p,h]=(0,n.useState)(""),[f,g]=(0,n.useState)("monthly_charge"),[j,b]=(0,n.useState)(""),[N,v]=(0,n.useState)(new Date),[y,w]=(0,n.useState)("unit_count"),[T,D]=(0,n.useState)(!1),[C,k]=(0,n.useState)(!1),[M,U]=(0,n.useState)("all"),[F,P]=(0,n.useState)([]),[z,L]=(0,n.useState)("");(0,n.useEffect)(()=>{if(t){if(d){let e=u.find(e=>e.key===d.description);e?(g(e.value),h("")):(g("other"),h(d.description)),b(d.totalAmount),v(new Date(d.date)),w(d.distributionMethod),D(d.paidByManager),k(d.deductFromFund||!1),U(d.chargeTo||"all"),P(d.applicableUnits||r.map(e=>e.id))}else g("monthly_charge"),h(""),b(""),v(new Date),w("unit_count"),D(!1),k(!1),U("all"),P(r.map(e=>e.id));L("")}},[t,d,r,u]),(0,n.useEffect)(()=>{T||k(!1),"general"===y&&(D(!0),k(!0))},[T,y]);let Z=(e,t)=>{P(a=>t?[...a,e]:a.filter(t=>t!==e))},$=e=>{P(e?r.map(e=>e.id):[])};return(0,s.jsx)(E.lG,{open:t,onOpenChange:a,children:(0,s.jsxs)(E.Cf,{className:"sm:max-w-lg",children:[(0,s.jsxs)(E.c7,{children:[(0,s.jsx)(E.L3,{className:"font-headline",children:d?c("addExpenseDialog.editTitle"):c("addExpenseDialog.addTitle")}),(0,s.jsx)(E.rr,{children:c("addExpenseDialog.description")})]}),(0,s.jsxs)("div",{className:"space-y-4 py-4 max-h-[70vh] overflow-y-auto px-2",children:[(0,s.jsxs)("div",{className:"grid grid-cols-4 items-start gap-4",children:[(0,s.jsx)(S.J,{className:"text-right rtl:text-left text-xs pt-3",children:c("addExpenseDialog.expenseDescription")}),(0,s.jsxs)("div",{className:"col-span-3 space-y-2",children:[(0,s.jsx)(el,{value:f,onValueChange:e=>g(e),dir:x,children:(0,s.jsx)("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-2",children:u.map(e=>(0,s.jsxs)("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[(0,s.jsx)(er,{value:e.value,id:"cat-".concat(e.value)}),(0,s.jsx)(S.J,{htmlFor:"cat-".concat(e.value),className:"font-normal text-xs",children:e.label})]},e.value))})}),"other"===f&&(0,s.jsx)(_.p,{value:p,onChange:e=>h(e.target.value),placeholder:c("addExpenseDialog.otherPlaceholder"),className:"mt-2"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsxs)(S.J,{htmlFor:"totalAmount",className:"text-right rtl:text-left text-xs",children:["custom"===y?c("addExpenseDialog.amountPerUnit"):c("addExpenseDialog.totalAmount")," ",c("addExpenseDialog.currency")]}),(0,s.jsx)(_.p,{id:"totalAmount",type:"number",value:j,onChange:e=>b(""===e.target.value?"":parseFloat(e.target.value)),className:"col-span-3 text-left",dir:"ltr"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(S.J,{htmlFor:"date",className:"text-right rtl:text-left text-xs",children:c("addExpenseDialog.date")}),(0,s.jsxs)(q,{children:[(0,s.jsx)(Y,{asChild:!0,children:(0,s.jsxs)(m.$,{variant:"outline",className:(0,i.cn)("col-span-3 justify-start text-right font-normal",!N&&"text-muted-foreground"),children:[(0,s.jsx)(A.A,{className:"ltr:mr-2 rtl:ml-2 h-4 w-4"}),N?(0,et.A)(N,"d MMMM yyyy",{locale:"fa"===o?X.A:ea.A}):(0,s.jsx)("span",{children:c("addExpenseDialog.selectDate")})]})}),(0,s.jsx)(G,{className:"w-auto p-0",align:"start",children:(0,s.jsx)(ee,{mode:"single",selected:N,onSelect:e=>e&&v(e),initialFocus:!0,locale:"fa"===o?X.A:ea.A})})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(S.J,{htmlFor:"distributionMethod",className:"text-right rtl:text-left text-xs",children:c("addExpenseDialog.distributionMethod")}),(0,s.jsxs)(R,{value:y,onValueChange:e=>w(e),dir:x,children:[(0,s.jsx)(J,{className:"col-span-3",children:(0,s.jsx)(B,{placeholder:c("addExpenseDialog.selectDistributionMethod")})}),(0,s.jsxs)(O,{children:[(0,s.jsx)(I,{value:"unit_count",children:c("addExpenseDialog.methods.unit_count")}),(0,s.jsx)(I,{value:"occupants",children:c("addExpenseDialog.methods.occupants")}),(0,s.jsx)(I,{value:"area",children:c("addExpenseDialog.methods.area")}),(0,s.jsx)(I,{value:"custom",children:c("addExpenseDialog.methods.custom")}),(0,s.jsx)(I,{value:"general",children:c("addExpenseDialog.methods.general")})]})]})]}),"custom"===y&&(0,s.jsxs)("div",{className:"col-span-4 space-y-4 rounded-lg border bg-muted/50 p-4",children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:c("addExpenseDialog.customAllocation.description")}),(0,s.jsx)(ed,{}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[(0,s.jsx)(W,{id:"select-all-units",checked:F.length===r.length,onCheckedChange:e=>$(e)}),(0,s.jsx)(S.J,{htmlFor:"select-all-units",className:"font-normal",children:c("addExpenseDialog.customAllocation.selectAll")})]}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 max-h-32 overflow-y-auto",children:r.map(e=>(0,s.jsxs)("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[(0,s.jsx)(W,{id:"unit-".concat(e.id),checked:F.includes(e.id),onCheckedChange:t=>Z(e.id,t)}),(0,s.jsx)(S.J,{htmlFor:"unit-".concat(e.id),className:"font-normal",children:c(e.name,{number:e.unitNumber})})]},e.id))})]})]}),"general"!==y&&(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(S.J,{className:"text-right rtl:text-left text-xs",children:c("addExpenseDialog.chargeTo")}),(0,s.jsxs)(el,{value:M,onValueChange:e=>U(e),className:"col-span-3 flex items-center gap-x-4",dir:x,children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[(0,s.jsx)(er,{value:"all",id:"r-all"}),(0,s.jsx)(S.J,{htmlFor:"r-all",className:"font-normal text-xs",children:c("addExpenseDialog.chargeToOptions.all")})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[(0,s.jsx)(er,{value:"owner",id:"r-owner"}),(0,s.jsx)(S.J,{htmlFor:"r-owner",className:"font-normal text-xs",children:c("addExpenseDialog.chargeToOptions.owner")})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[(0,s.jsx)(er,{value:"tenant",id:"r-tenant"}),(0,s.jsx)(S.J,{htmlFor:"r-tenant",className:"font-normal text-xs",children:c("addExpenseDialog.chargeToOptions.tenant")})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(S.J,{htmlFor:"paidByManager",className:"text-right rtl:text-left text-xs",children:c("addExpenseDialog.paidByManager")}),(0,s.jsx)(V.d,{id:"paidByManager",checked:T,onCheckedChange:D,className:"col-span-3 justify-self-start",disabled:"general"===y})]}),T&&(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(S.J,{htmlFor:"deductFromFund",className:"text-right rtl:text-left text-xs",children:c("addExpenseDialog.deductFromFund")}),(0,s.jsx)(V.d,{id:"deductFromFund",checked:C,onCheckedChange:k,className:"col-span-3 justify-self-start",disabled:"general"===y})]}),z&&(0,s.jsx)("p",{className:"text-sm font-medium text-destructive col-span-4 text-center",children:z})]}),(0,s.jsxs)(E.Es,{children:[(0,s.jsx)(m.$,{variant:"outline",onClick:a,children:c("global.cancel")}),(0,s.jsx)(m.$,{type:"submit",onClick:()=>{let e;if("other"===f)e=p.trim();else{var t;e=(null==(t=u.find(e=>e.value===f))?void 0:t.key)||"addExpenseDialog.categories.other"}return"other"===f&&!e||""===j||j<=0?void L(c("addExpenseDialog.errorInvalid")):"custom"===y&&0===F.length?void L(c("addExpenseDialog.errorCustomNoUnits")):(L(""),void l({description:e,totalAmount:Number(j),date:N.toISOString(),distributionMethod:y,paidByManager:T,chargeTo:"general"===y?"all":M,applicableUnits:"custom"===y?F:void 0,isBuildingCharge:"monthly_charge"===f,deductFromFund:!!T&&C},null==d?void 0:d.id))},children:c("global.save")})]})]})})}let ex=(0,a(2085).F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function em(e){let{className:t,variant:a,...n}=e;return(0,s.jsx)("div",{className:(0,i.cn)(ex({variant:a}),t),...n})}var eu=a(8127),ep=a(4371);function eh(e){let{status:t,onClick:a}=e,n="paid"===t,{t:l}=(0,ec.o)();return(0,s.jsx)("button",{onClick:a,className:"w-fit rounded-full transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",children:(0,s.jsxs)(em,{className:(0,i.cn)("flex cursor-pointer items-center gap-1 border-2 text-xs",n?"border-green-500 bg-green-100 text-green-700 hover:bg-green-200":"border-red-500 bg-red-100 text-red-700 hover:bg-red-200","dark:bg-transparent"),children:[n?(0,s.jsx)(eu.A,{size:12}):(0,s.jsx)(ep.A,{size:12}),(0,s.jsx)("span",{children:l(n?"paymentStatus.paid":"paymentStatus.unpaid")})]})})}var ef=a(3478);let eg=ef.bL,ej=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(ef.q7,{ref:t,className:(0,i.cn)("border-b",a),...n})});ej.displayName="AccordionItem";let eb=n.forwardRef((e,t)=>{let{className:a,children:n,...l}=e;return(0,s.jsx)(ef.Y9,{className:"flex",children:(0,s.jsxs)(ef.l9,{ref:t,className:(0,i.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",a),...l,children:[n,(0,s.jsx)(U.A,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})})});eb.displayName=ef.l9.displayName;let eN=n.forwardRef((e,t)=>{let{className:a,children:n,...l}=e;return(0,s.jsx)(ef.UC,{ref:t,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...l,children:(0,s.jsx)("div",{className:(0,i.cn)("pb-4 pt-0",a),children:n})})});eN.displayName=ef.UC.displayName;var ev=a(10),ey=a(1034);let ew=(e,t,a)=>{if("general"===e.distributionMethod)return 0;let s=0,n=e.chargeTo||"all",l=!t.tenantName;if("tenant"===n&&l||"owner"===n&&!l)return 0;if("custom"===e.distributionMethod){var r;s=(null==(r=e.applicableUnits)?void 0:r.includes(t.id))?e.totalAmount:0}else{let l=a.filter(e=>{let t=!e.tenantName;return"tenant"===n?!t:"owner"!==n||t});if(!l.some(e=>e.id===t.id))return 0;switch(e.distributionMethod){case"unit_count":{let t=l.length;s=t>0?e.totalAmount/t:0;break}case"occupants":{let a=l.reduce((e,t)=>e+t.occupants,0);s=a>0?e.totalAmount*t.occupants/a:0;break}case"area":{let a=l.reduce((e,t)=>e+t.area,0);s=a>0?e.totalAmount*t.area/a:0;break}default:s=0}}return 0===s?0:500*Math.ceil(s/500)};function eT(e){let{building:t,onDataChange:a}=e,{addExpenseToBuilding:r,updateExpenseInBuilding:i,updateExpensePaymentStatus:d,deleteExpenseFromBuilding:c}=(0,l.C)(),[o,x]=(0,n.useState)(!1),[E,_]=(0,n.useState)(!1),[M,U]=(0,n.useState)(null),[F,P]=(0,n.useState)(null),[z,L]=(0,n.useState)("all"),[Z,W]=(0,n.useState)("all"),[$,q]=(0,n.useState)(!1),[Y,G]=(0,n.useState)("byDate"),{t:H,language:K,direction:Q}=(0,ec.o)(),ee=e=>{switch(e){case"owner":return H("expensesTab.badges.chargeToOwner");case"tenant":return H("expensesTab.badges.chargeToTenant");default:return H("expensesTab.badges.chargeToAll")}},es=(0,n.useMemo)(()=>["all",...Array.from(new Set(t.expenses.map(e=>(0,ey.A)(new Date(e.date)).toString()))).sort((e,t)=>t.localeCompare(e))],[t.expenses]),en=(0,n.useMemo)(()=>t.expenses.filter(e=>{let t=new Date(e.date),a="all"===z||(0,ey.A)(t).toString()===z,s="all"===Z||(t.getMonth()+1).toString()===Z;return a&&s}).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),[t.expenses,z,Z]),ei=(0,n.useMemo)(()=>("byDate"===Y?en:t.expenses).filter(e=>!$||e.paidByManager).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),[Y,en,t.expenses,$]),ed=(0,n.useMemo)(()=>{let e={};return t.units.forEach(a=>{let s=[],n=0;for(let e of t.expenses){let l=ew(e,a,t.units);l>0&&(s.push({...e,amount:l}),"unpaid"===(e.paymentStatus[a.id]||"unpaid")&&(n+=l))}s.sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),e[a.id]={unit:a,expenses:s,totalUnpaid:n}}),e},[t.units,t.expenses]),ex=e=>{U(e),x(!0)},eu=()=>{U(null),x(!1)},ep=(e,s,n)=>{d(t.id,e,s,"paid"===n?"unpaid":"paid",a)},ef=e=>{P(e),_(!0)},eT=e=>{if("custom"===e.distributionMethod){var t,a;return e.totalAmount*(null!=(a=null==(t=e.applicableUnits)?void 0:t.length)?a:0)}return e.totalAmount},eD=e=>new Intl.NumberFormat("fa"===K?"fa-IR":"en-US").format(e),eA=e=>e.includes(".")?H(e):e,eC=e=>e.name.includes(".")?H(e.name,{number:e.unitNumber}):e.name;return(0,s.jsxs)(u.Zp,{children:[(0,s.jsxs)(u.aR,{children:[(0,s.jsxs)("div",{className:"flex justify-between items-start flex-col sm:flex-row gap-4",children:[(0,s.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,s.jsx)(u.ZB,{children:H("expensesTab.title")}),(0,s.jsx)(u.BT,{children:H("expensesTab.description")})]}),(0,s.jsxs)(m.$,{onClick:()=>ex(null),className:"flex items-center gap-2 rtl:ml-0 ltr:ml-auto rtl:mr-auto shrink-0",children:[(0,s.jsx)(D.A,{size:20}),(0,s.jsx)("span",{children:H("expensesTab.addExpense")})]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-4 pt-4 border-t mt-4 items-start rtl:sm:items-end ltr:sm:items-start",children:[(0,s.jsx)("div",{className:"flex flex-wrap gap-4 items-center w-full justify-start rtl:justify-end",children:(0,s.jsxs)(el,{value:Y,onValueChange:e=>G(e),className:"flex gap-x-4 gap-y-2 items-center",dir:Q,children:[(0,s.jsx)(S.J,{className:"hidden sm:inline-block",children:H("expensesTab.viewMode.title")}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[(0,s.jsx)(er,{value:"byDate",id:"byDate"}),(0,s.jsxs)(S.J,{htmlFor:"byDate",className:"font-normal flex items-center gap-2",children:[(0,s.jsx)(A.A,{size:16})," ",H("expensesTab.viewMode.byDate")]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[(0,s.jsx)(er,{value:"byUnit",id:"byUnit"}),(0,s.jsxs)(S.J,{htmlFor:"byUnit",className:"font-normal flex items-center gap-2",children:[(0,s.jsx)(C.A,{size:16})," ",H("expensesTab.viewMode.byUnit")]})]})]})}),"byDate"===Y&&(0,s.jsxs)("div",{className:"flex flex-wrap gap-4 items-center w-full justify-start rtl:justify-end",children:[(0,s.jsx)(k.A,{className:"text-muted-foreground"}),(0,s.jsxs)(R,{value:z,onValueChange:L,dir:Q,children:[(0,s.jsx)(J,{className:"w-[180px]",children:(0,s.jsx)(B,{placeholder:H("expensesTab.filterByYear")})}),(0,s.jsx)(O,{children:es.map(e=>(0,s.jsx)(I,{value:e,children:"all"===e?H("expensesTab.allYears"):eD(parseInt(e))},e))})]}),(0,s.jsxs)(R,{value:Z,onValueChange:W,dir:Q,children:[(0,s.jsx)(J,{className:"w-[180px]",children:(0,s.jsx)(B,{placeholder:H("expensesTab.filterByMonth")})}),(0,s.jsxs)(O,{children:[(0,s.jsx)(I,{value:"all",children:H("expensesTab.allMonths")}),Array.from({length:12},(e,t)=>(0,s.jsx)(I,{value:String(t+1),children:(0,et.A)(new Date(2e3,t,1),"MMMM",{locale:"fa"===K?X.A:ea.A})},t+1))]})]})]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-4 items-center justify-start rtl:justify-end w-full",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[(0,s.jsx)(v.A,{className:"text-muted-foreground"}),(0,s.jsx)(S.J,{htmlFor:"manager-expenses",children:H("expensesTab.managerPayments")}),(0,s.jsx)(V.d,{id:"manager-expenses",checked:$,onCheckedChange:q}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:H("expensesTab.managerPaymentsTooltip")})]})})]})]}),(0,s.jsx)(u.Wu,{children:"byDate"===Y?(0,s.jsxs)("div",{className:"overflow-x-auto",children:[(0,s.jsxs)(p,{children:[(0,s.jsx)(h,{children:(0,s.jsxs)(g,{children:[(0,s.jsx)(j,{children:H("expensesTab.table.description")}),(0,s.jsx)(j,{children:H("expensesTab.table.date")}),(0,s.jsx)(j,{children:H("expensesTab.table.totalAmount")}),t.units.map(e=>(0,s.jsx)(j,{className:"text-center",children:eC(e)},e.id)),(0,s.jsx)(j,{className:"text-center",children:H("expensesTab.table.actions")})]})}),(0,s.jsx)(f,{children:ei.map(e=>(0,s.jsxs)(g,{children:[(0,s.jsx)(b,{className:"font-medium",children:(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("span",{children:eA(e.description)}),(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:["general"===e.distributionMethod&&(0,s.jsxs)(em,{variant:"secondary",className:"w-fit text-xs flex items-center gap-1",children:[(0,s.jsx)(N.A,{size:12}),H("expensesTab.badges.generalExpense")]}),e.paidByManager&&(0,s.jsxs)(em,{variant:"secondary",className:"w-fit text-xs flex items-center gap-1",children:[(0,s.jsx)(v.A,{size:12}),H("expensesTab.badges.paidByManager")]}),"general"!==e.distributionMethod&&(0,s.jsxs)(em,{variant:"outline",className:"w-fit text-xs flex items-center gap-1",children:[(0,s.jsx)(y.A,{size:12}),ee(e.chargeTo)]})]})]})}),(0,s.jsx)(b,{children:(0,et.A)(new Date(e.date),"d MMMM yyyy",{locale:"fa"===K?X.A:ea.A})}),(0,s.jsx)(b,{children:eD(Math.ceil(eT(e)))}),t.units.map(a=>{let n=ew(e,a,t.units),l=e.paymentStatus[a.id]||"unpaid",r=n>0;return(0,s.jsx)(b,{className:"text-center",children:r?(0,s.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,s.jsx)("span",{children:eD(n)}),(0,s.jsx)(eh,{status:l,onClick:()=>ep(e.id,a.id,l)})]}):(0,s.jsx)("span",{children:"-"})},a.id)}),(0,s.jsxs)(b,{className:"text-center",children:[(0,s.jsx)(m.$,{variant:"ghost",size:"icon",onClick:()=>ex(e),children:(0,s.jsx)(w.A,{className:"h-4 w-4"})}),(0,s.jsx)(m.$,{variant:"ghost",size:"icon",onClick:()=>ef(e.id),className:"text-destructive hover:text-destructive",children:(0,s.jsx)(T.A,{className:"h-4 w-4"})})]})]},e.id))})]}),0===ei.length&&(0,s.jsx)("div",{className:"text-center py-10 text-muted-foreground",children:H("expensesTab.noExpensesFound")})]}):(0,s.jsx)(eg,{type:"single",collapsible:!0,className:"w-full",children:Object.values(ed).map(e=>{let{unit:t,expenses:a,totalUnpaid:n}=e;return(0,s.jsxs)(ej,{value:t.id,children:[(0,s.jsx)(eb,{children:(0,s.jsxs)("div",{className:"flex justify-between w-full items-center rtl:pr-2 ltr:pl-2",children:[(0,s.jsx)("span",{children:eC(t)}),n>0?(0,s.jsx)(em,{variant:"destructive",children:H("expensesTab.unpaidAmount",{amount:eD(n)})}):(0,s.jsx)(em,{className:"bg-green-500 hover:bg-green-600",children:H("expensesTab.allPaid")})]})}),(0,s.jsx)(eN,{children:a.length>0?(0,s.jsxs)(p,{children:[(0,s.jsx)(h,{children:(0,s.jsxs)(g,{children:[(0,s.jsx)(j,{children:H("expensesTab.table.description")}),(0,s.jsx)(j,{children:H("expensesTab.table.date")}),(0,s.jsx)(j,{children:H("expensesTab.table.unitShare")}),(0,s.jsx)(j,{className:"text-center",children:H("expensesTab.table.paymentStatus")})]})}),(0,s.jsx)(f,{children:a.map(e=>(0,s.jsxs)(g,{children:[(0,s.jsx)(b,{className:"font-medium",children:eA(e.description)}),(0,s.jsx)(b,{children:(0,et.A)(new Date(e.date),"d MMMM yyyy",{locale:"fa"===K?X.A:ea.A})}),(0,s.jsx)(b,{children:eD(e.amount)}),(0,s.jsx)(b,{className:"flex justify-center",children:(0,s.jsx)(eh,{status:e.paymentStatus[t.id]||"unpaid",onClick:()=>ep(e.id,t.id,e.paymentStatus[t.id]||"unpaid")})})]},"".concat(t.id,"-").concat(e.id)))})]}):(0,s.jsx)("p",{className:"text-center text-muted-foreground p-4",children:H("expensesTab.noExpensesForUnit")})})]},t.id)})})}),(0,s.jsx)(eo,{isOpen:o,onClose:eu,onSave:(e,s)=>{let n=()=>{a(),eu()};s?i(t.id,s,e,n):r(t.id,e,n)},units:t.units,expense:M}),(0,s.jsx)(ev.Lt,{open:E,onOpenChange:_,children:(0,s.jsxs)(ev.EO,{children:[(0,s.jsxs)(ev.wd,{children:[(0,s.jsx)(ev.r7,{children:H("expensesTab.confirmDeleteTitle")}),(0,s.jsx)(ev.$v,{children:H("expensesTab.confirmDeleteDesc")})]}),(0,s.jsxs)(ev.ck,{children:[(0,s.jsx)(ev.Zr,{children:H("global.cancel")}),(0,s.jsx)(ev.Rx,{onClick:()=>{F&&c(t.id,F,()=>{a(),_(!1),P(null)})},className:"bg-destructive hover:bg-destructive/90",children:H("global.delete")})]})]})})]})}function eD(e){let{isOpen:t,onClose:a,onSave:l,unit:r}=e,{t:i}=(0,ec.o)(),[d,c]=(0,n.useState)({customName:"",area:0,occupants:1,ownerName:"",ownerPhone:"",tenantName:"",tenantPhone:""}),[o,x]=(0,n.useState)(!1),[u,p]=(0,n.useState)("");(0,n.useEffect)(()=>{if(t){if(r){let e=!r.name.startsWith("unitsTab.table.defaultUnitName"),t=!r.tenantName&&0===r.occupants;x(t),c({customName:e?r.name:"",area:r.area,occupants:t?0:r.occupants,ownerName:r.ownerName,ownerPhone:r.ownerPhone||"",tenantName:t?"":r.tenantName||"",tenantPhone:t?"":r.tenantPhone||""})}else x(!1),c({customName:"",area:0,occupants:1,ownerName:"",ownerPhone:"",tenantName:"",tenantPhone:""});p("")}},[r,t]),(0,n.useEffect)(()=>{o?c(e=>({...e,occupants:0,tenantName:"",tenantPhone:""})):c(e=>({...e,occupants:0===e.occupants?1:e.occupants}))},[o]);let h=e=>{let{id:t,value:a,type:s}=e.target;c(e=>({...e,[t]:"number"===s?parseFloat(a)||0:a}))};return(0,s.jsx)(E.lG,{open:t,onOpenChange:a,children:(0,s.jsxs)(E.Cf,{className:"sm:max-w-[425px]",children:[(0,s.jsxs)(E.c7,{children:[(0,s.jsx)(E.L3,{className:"font-headline",children:r?i("addUnitDialog.editTitle"):i("addUnitDialog.addTitle")}),(0,s.jsx)(E.rr,{children:i("addUnitDialog.description")})]}),(0,s.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(S.J,{htmlFor:"customName",className:"text-right",children:i("addUnitDialog.nameLabel")}),(0,s.jsx)(_.p,{id:"customName",value:d.customName,onChange:h,className:"col-span-3",placeholder:i("unitsTab.table.defaultUnitName",{number:null==r?void 0:r.unitNumber})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(S.J,{htmlFor:"area",className:"text-right",children:i("addUnitDialog.areaLabel")}),(0,s.jsx)(_.p,{id:"area",type:"number",value:d.area,onChange:h,className:"col-span-3"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(S.J,{htmlFor:"ownerName",className:"text-right",children:i("addUnitDialog.ownerNameLabel")}),(0,s.jsx)(_.p,{id:"ownerName",value:d.ownerName,onChange:h,className:"col-span-3"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(S.J,{htmlFor:"ownerPhone",className:"text-right",children:i("addUnitDialog.ownerPhoneLabel")}),(0,s.jsx)(_.p,{id:"ownerPhone",value:d.ownerPhone,onChange:h,className:"col-span-3",placeholder:i("global.optional")})]}),(0,s.jsx)(ed,{}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[(0,s.jsx)(W,{id:"isVacant",checked:o,onCheckedChange:e=>x(e)}),(0,s.jsx)(S.J,{htmlFor:"isVacant",className:"font-medium",children:i("addUnitDialog.isVacantLabel")})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(S.J,{htmlFor:"occupants",className:"text-right",children:i("addUnitDialog.occupantsLabel")}),(0,s.jsx)(_.p,{id:"occupants",type:"number",value:d.occupants,onChange:h,className:"col-span-3",disabled:o})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(S.J,{htmlFor:"tenantName",className:"text-right",children:i("addUnitDialog.tenantNameLabel")}),(0,s.jsx)(_.p,{id:"tenantName",value:d.tenantName||"",onChange:h,className:"col-span-3",placeholder:i("global.optional"),disabled:o})]}),(0,s.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,s.jsx)(S.J,{htmlFor:"tenantPhone",className:"text-right",children:i("addUnitDialog.tenantPhoneLabel")}),(0,s.jsx)(_.p,{id:"tenantPhone",value:d.tenantPhone||"",onChange:h,className:"col-span-3",placeholder:i("global.optional"),disabled:o})]}),u&&(0,s.jsx)("p",{className:"text-sm font-medium text-destructive col-span-4 text-center",children:u})]}),(0,s.jsxs)(E.Es,{children:[(0,s.jsx)(m.$,{variant:"outline",onClick:a,children:i("global.cancel")}),(0,s.jsx)(m.$,{type:"submit",onClick:()=>{if(!d.ownerName.trim())return void p(i("addUnitDialog.errorOwnerRequired"));p("");let e=d.customName.trim()||"unitsTab.table.defaultUnitName";l({...d,name:e,ownerPhone:d.ownerPhone.trim()||void 0,tenantName:o?null:d.tenantName.trim()||null,tenantPhone:o?void 0:d.tenantPhone.trim()||void 0,occupants:o?0:Math.max(1,d.occupants),area:d.area})},children:i("global.save")})]})]})})}function eA(e){let{building:t,onDataChange:a}=e,{addUnitToBuilding:r,updateUnitInBuilding:i}=(0,l.C)(),[d,c]=(0,n.useState)(!1),[o,x]=(0,n.useState)(null),{t:N}=(0,ec.o)(),v=e=>{x(e),c(!0)},y=e=>e.name.includes(".")?N(e.name,{number:e.unitNumber}):e.name;return(0,s.jsxs)(u.Zp,{children:[(0,s.jsxs)(u.aR,{className:"flex flex-row justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(u.ZB,{children:N("unitsTab.title")}),(0,s.jsx)(u.BT,{children:N("unitsTab.description")})]}),(0,s.jsxs)(m.$,{onClick:()=>{x(null),c(!0)},className:"flex items-center gap-2",children:[(0,s.jsx)(D.A,{size:20}),(0,s.jsx)("span",{children:N("unitsTab.addUnit")})]})]}),(0,s.jsx)(u.Wu,{children:(0,s.jsxs)(p,{children:[(0,s.jsx)(h,{children:(0,s.jsxs)(g,{children:[(0,s.jsx)(j,{children:N("unitsTab.table.name")}),(0,s.jsx)(j,{children:N("unitsTab.table.area")}),(0,s.jsx)(j,{children:N("unitsTab.table.occupants")}),(0,s.jsx)(j,{children:N("unitsTab.table.ownerName")}),(0,s.jsx)(j,{children:N("addUnitDialog.ownerPhoneLabel")}),(0,s.jsx)(j,{children:N("unitsTab.table.tenantName")}),(0,s.jsx)(j,{children:N("addUnitDialog.tenantPhoneLabel")}),(0,s.jsx)(j,{children:N("unitsTab.table.actions")})]})}),(0,s.jsx)(f,{children:t.units.map(e=>(0,s.jsxs)(g,{children:[(0,s.jsx)(b,{className:"font-medium",children:y(e)}),(0,s.jsx)(b,{children:e.area}),(0,s.jsx)(b,{children:e.occupants}),(0,s.jsx)(b,{children:e.ownerName}),(0,s.jsx)(b,{children:e.ownerPhone||" - "}),(0,s.jsx)(b,{children:e.tenantName||" - "}),(0,s.jsx)(b,{children:e.tenantPhone||" - "}),(0,s.jsx)(b,{children:(0,s.jsx)(m.$,{variant:"ghost",size:"icon",onClick:()=>v(e),children:(0,s.jsx)(w.A,{className:"h-4 w-4"})})})]},e.id))})]})}),(0,s.jsx)(eD,{isOpen:d,onClose:()=>{c(!1),x(null)},onSave:e=>{let s=()=>{a(),c(!1),x(null)};o?i(t.id,{...o,...e},s):r(t.id,e,s)},unit:o})]})}var eC=a(8186),ek=a(3920),eE=a(9591),e_=a(3926),eS=a(203),eM=a(1949),eU=a(8718),eF=a(7481),eP=a(3925),eR=a(4822);let eB=(e,t,a)=>{if("general"===e.distributionMethod)return 0;let s=0,n=e.chargeTo||"all",l=!t.tenantName;if("tenant"===n&&l||"owner"===n&&!l)return 0;if("custom"===e.distributionMethod){var r;s=(null==(r=e.applicableUnits)?void 0:r.includes(t.id))?e.totalAmount:0}else{let l=a.filter(e=>{let t=!e.tenantName;return"tenant"===n?!t:"owner"!==n||t});if(!l.some(e=>e.id===t.id))return 0;switch(e.distributionMethod){case"unit_count":{let t=l.length;s=t>0?e.totalAmount/t:0;break}case"occupants":{let a=l.reduce((e,t)=>e+t.occupants,0);s=a>0?e.totalAmount*t.occupants/a:0;break}case"area":{let a=l.reduce((e,t)=>e+t.area,0);s=a>0?e.totalAmount*t.area/a:0;break}default:s=0}}return 0===s?0:500*Math.ceil(s/500)};function eJ(e){let{building:t}=e,[a,l]=(0,n.useState)("values"),{toast:r}=(0,eF.dj)(),{t:i,language:d,direction:c}=(0,ec.o)(),o=e=>new Intl.NumberFormat("fa"===d?"fa-IR":"en-US").format(e),x=e=>e.includes(".")?i(e):e,p=e=>e.name.includes(".")?i(e.name,{number:e.unitNumber}):e.name,h=(0,n.useMemo)(()=>{let e=t.units.length,a=t.units.reduce((e,t)=>e+t.occupants,0),s=t.units.filter(e=>null===e.tenantName&&0===e.occupants),n=s.length,l=s.map(e=>p(e)),r=t.expenses.filter(e=>e.isBuildingCharge).reduce((e,t)=>{if("custom"===t.distributionMethod){var a;return e+t.totalAmount*((null==(a=t.applicableUnits)?void 0:a.length)||0)}return e+t.totalAmount},0),i=t.expenses.filter(e=>e.deductFromFund).reduce((e,t)=>{if("custom"===t.distributionMethod){var a;return e+t.totalAmount*((null==(a=t.applicableUnits)?void 0:a.length)||0)}return t.distributionMethod,e+t.totalAmount},0),d=new Date,c=(0,eR.A)(d);return{totalUnits:e,totalOccupants:a,vacantUnitsCount:n,vacantUnitNames:l,fundBalance:r-i,overdueDebts:t.units.map(e=>{let a=t.expenses.reduce((a,s)=>{let n=new Date(s.date),l="unpaid"===(s.paymentStatus[e.id]||"unpaid");return n<c&&l?a+eB(s,e,t.units):a},0);return{unitId:e.id,unitName:p(e),amount:a}}).filter(e=>e.amount>0),fundInflow:r,fundOutflow:i}},[t,i,d]);return(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)(u.Zp,{children:[(0,s.jsx)(u.aR,{className:"flex flex-col rtl:items-end ltr:items-start",children:(0,s.jsx)(u.ZB,{children:i("reportsTab.stats.title")})}),(0,s.jsxs)(u.Wu,{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[(0,s.jsx)(u.Zp,{className:"p-4 bg-muted/50",children:(0,s.jsxs)("div",{className:"flex items-center gap-4",dir:c,children:[(0,s.jsx)(eC.A,{className:"w-8 h-8 text-primary"}),(0,s.jsxs)("div",{className:"rtl:text-right ltr:text-left",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:i("reportsTab.stats.totalUnits")}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:o(h.totalUnits)})]})]})}),(0,s.jsx)(u.Zp,{className:"p-4 bg-muted/50",children:(0,s.jsxs)("div",{className:"flex items-center gap-4",dir:c,children:[(0,s.jsx)(y.A,{className:"w-8 h-8 text-primary"}),(0,s.jsxs)("div",{className:"rtl:text-right ltr:text-left",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:i("reportsTab.stats.totalOccupants")}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:o(h.totalOccupants)})]})]})}),(0,s.jsxs)(u.Zp,{className:"p-4 bg-muted/50 flex flex-col justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",dir:c,children:[(0,s.jsx)(ek.A,{className:"w-8 h-8 text-primary"}),(0,s.jsxs)("div",{className:"rtl:text-right ltr:text-left",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:i("reportsTab.stats.vacantUnits")}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:o(h.vacantUnitsCount)})]})]}),h.vacantUnitsCount>0&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mt-2 truncate rtl:text-right ltr:text-left",children:[i("reportsTab.stats.whichUnits"),": ",h.vacantUnitNames.join(", ")]})]})]})]}),(0,s.jsxs)(u.Zp,{children:[(0,s.jsx)(u.aR,{className:"flex flex-col rtl:items-end ltr:items-start",children:(0,s.jsx)(u.ZB,{children:i("reportsTab.fund.title")})}),(0,s.jsxs)(u.Wu,{className:"space-y-4",children:[(0,s.jsx)("div",{className:"flex items-center justify-center p-6 rounded-lg bg-gradient-to-br from-primary/80 to-primary text-primary-foreground",children:(0,s.jsxs)("div",{className:"text-center flex items-center gap-4",children:[(0,s.jsx)(eE.A,{size:40}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-semibold",children:i("reportsTab.fund.balance")}),(0,s.jsxs)("p",{className:"text-4xl font-bold tracking-tight",children:[o(h.fundBalance)," ",i("addExpenseDialog.currency")]})]})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-center",children:[(0,s.jsxs)("div",{className:"p-3 bg-green-100 dark:bg-green-900/50 rounded-lg",children:[(0,s.jsxs)("p",{className:"text-sm text-green-600 dark:text-green-400 font-semibold flex items-center justify-center gap-2",children:[(0,s.jsx)(e_.A,{size:16})," ",i("reportsTab.fund.inflow")]}),(0,s.jsx)("p",{className:"font-bold",children:o(h.fundInflow)})]}),(0,s.jsxs)("div",{className:"p-3 bg-red-100 dark:bg-red-900/50 rounded-lg",children:[(0,s.jsxs)("p",{className:"text-sm text-red-600 dark:text-red-400 font-semibold flex items-center justify-center gap-2",children:[(0,s.jsx)(eS.A,{size:16})," ",i("reportsTab.fund.outflow")]}),(0,s.jsx)("p",{className:"font-bold",children:o(h.fundOutflow)})]})]})]})]}),(0,s.jsxs)(u.Zp,{children:[(0,s.jsxs)(u.aR,{className:"flex flex-col rtl:items-end ltr:items-start",children:[(0,s.jsxs)(u.ZB,{className:"flex items-center gap-2 rtl:flex-row-reverse",children:[(0,s.jsx)(eM.A,{className:"text-destructive"}),i("reportsTab.overdue.title")]}),(0,s.jsx)(u.BT,{children:i("reportsTab.overdue.description")})]}),(0,s.jsx)(u.Wu,{children:h.overdueDebts.length>0?(0,s.jsx)("ul",{className:"space-y-2",children:h.overdueDebts.map(e=>(0,s.jsxs)("li",{className:"flex justify-between items-center p-3 bg-muted/50 rounded-lg",dir:c,children:[(0,s.jsx)("span",{className:"font-medium",children:e.unitName}),(0,s.jsxs)("span",{className:"font-semibold text-destructive",children:[o(e.amount)," ",i("addExpenseDialog.currency")]})]},e.unitId))}):(0,s.jsx)("p",{className:"text-center text-muted-foreground py-4",children:i("reportsTab.overdue.none")})})]}),(0,s.jsxs)(u.Zp,{children:[(0,s.jsxs)(u.aR,{className:"flex flex-col rtl:items-end ltr:items-start",children:[(0,s.jsx)(u.ZB,{children:i("reportsTab.export.title")}),(0,s.jsx)(u.BT,{children:i("reportsTab.export.description")})]}),(0,s.jsxs)(u.Wu,{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-4 rtl:text-right ltr:text-left",children:[(0,s.jsx)(S.J,{className:"font-semibold",children:i("reportsTab.exportType")}),(0,s.jsxs)(el,{defaultValue:"values",value:a,onValueChange:l,dir:c,children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[(0,s.jsx)(er,{value:"values",id:"r1"}),(0,s.jsx)(S.J,{htmlFor:"r1",children:i("reportsTab.exportValues")})]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground ltr:pl-6 rtl:pr-6",children:i("reportsTab.exportValuesDesc")}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[(0,s.jsx)(er,{value:"formulas",id:"r2",disabled:!0}),(0,s.jsx)(S.J,{htmlFor:"r2",children:i("reportsTab.exportFormulas")})]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground ltr:pl-6 rtl:pr-6",children:i("reportsTab.exportFormulasDesc")})]})]}),(0,s.jsx)("div",{className:"flex",dir:c,children:(0,s.jsxs)(m.$,{onClick:()=>{try{let e=eP.Wp.book_new(),a=[["buildingId",t.id],["buildingName",t.name]],s=eP.Wp.aoa_to_sheet(a);eP.Wp.book_append_sheet(e,s,"metadata");let n=t.units.map(e=>({id:e.id,unitNumber:e.unitNumber,name:p(e),area:e.area,occupants:e.occupants,ownerName:e.ownerName,ownerPhone:e.ownerPhone,tenantName:e.tenantName,tenantPhone:e.tenantPhone})),l=eP.Wp.json_to_sheet(n);eP.Wp.book_append_sheet(e,l,"Units");let d=t.expenses.map(e=>({id:e.id,description:x(e.description),totalAmount:e.totalAmount,date:new Date(e.date).toISOString().split("T")[0],distributionMethod:e.distributionMethod,chargeTo:e.chargeTo,paidByManager:e.paidByManager,isBuildingCharge:e.isBuildingCharge,deductFromFund:e.deductFromFund,applicableUnits:JSON.stringify(e.applicableUnits),paymentStatus:JSON.stringify(e.paymentStatus)})),c=eP.Wp.json_to_sheet(d);eP.Wp.book_append_sheet(e,c,"Expenses"),t.units.forEach(a=>{if("number"!=typeof a.unitNumber)return void console.warn("Skipping sheet for unit with invalid unitNumber:",a);let s=t.expenses.map(e=>{let s=eB(e,a,t.units);return 0===s?null:{expenseId:e.id,description:x(e.description),date:new Date(e.date).toISOString().split("T")[0],unitShare:s,paymentStatus:i("paymentStatus.".concat(e.paymentStatus[a.id]||"unpaid"))}}).filter(Boolean);if(s.length>0){let t=eP.Wp.json_to_sheet(s),n="Unit_".concat(a.unitNumber).slice(0,31);eP.Wp.book_append_sheet(e,t,n)}}),eP._h(e,"".concat(t.name,"-report.xlsx")),r({title:i("reportsTab.exportSuccessTitle"),description:i("reportsTab.exportSuccessDesc",{buildingName:t.name}),className:"bg-primary text-primary-foreground"})}catch(e){console.error("Excel export failed:",e),r({title:i("reportsTab.exportErrorTitle"),description:i("reportsTab.exportErrorDesc"),variant:"destructive"})}},className:"w-full md:w-auto flex items-center gap-2 rtl:mr-auto ltr:ml-auto",children:[(0,s.jsx)(eU.A,{size:20}),(0,s.jsx)("span",{children:i("reportsTab.exportButton")})]})})]})]})]})}var ez=a(6874),eL=a.n(ez),eO=a(2543),eI=a(9968),eZ=a(3173),eW=a(9114),eV=a(469);function e$(e){let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,i.cn)("animate-pulse rounded-md bg-muted",t),...a})}function eq(e){let{buildingId:t}=e,{getBuildingById:a,loading:r}=(0,l.C)(),[i,m]=(0,n.useState)(void 0),{t:u,language:p}=(0,ec.o)(),h=(0,n.useCallback)(()=>{m(a(t))},[t,a]);(0,n.useEffect)(()=>{r||h()},[r,h]);let f=()=>{h()},g="fa"===p?eO.A:eI.A;return r||void 0===i?(0,s.jsxs)("div",{children:[(0,s.jsx)(e$,{className:"h-10 w-1/4 mb-2"}),(0,s.jsx)(e$,{className:"h-6 w-1/2 mb-8"}),(0,s.jsx)(e$,{className:"h-12 w-full"})]}):i?(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)(eZ.A,{className:"text-primary",size:36}),(0,s.jsx)("h1",{className:"text-4xl font-bold font-headline text-primary",children:i.name})]}),(0,s.jsx)("p",{className:"text-lg text-muted-foreground mb-8",children:u("dashboard.title")}),(0,s.jsxs)(d,{defaultValue:"reports",className:"w-full",children:[(0,s.jsxs)(c,{className:"grid w-full grid-cols-3 bg-muted/50",children:[(0,s.jsxs)(o,{value:"expenses",className:"flex items-center gap-2",children:[(0,s.jsx)(eW.A,{size:16}),u("dashboard.tabs.expenses")]}),(0,s.jsxs)(o,{value:"units",className:"flex items-center gap-2",children:[(0,s.jsx)(eC.A,{size:16}),u("dashboard.tabs.units")]}),(0,s.jsxs)(o,{value:"reports",className:"flex items-center gap-2",children:[(0,s.jsx)(eV.A,{size:16}),u("dashboard.tabs.reports")]})]}),(0,s.jsx)(x,{value:"expenses",children:(0,s.jsx)(eT,{building:i,onDataChange:f})}),(0,s.jsx)(x,{value:"units",children:(0,s.jsx)(eA,{building:i,onDataChange:f})}),(0,s.jsx)(x,{value:"reports",children:(0,s.jsx)(eJ,{building:i})})]})]}):(0,s.jsxs)("div",{className:"text-center py-16",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-destructive",children:u("dashboard.buildingNotFound")}),(0,s.jsx)("p",{className:"text-muted-foreground mt-2",children:u("dashboard.buildingNotFoundDesc")}),(0,s.jsx)(Button,{asChild:!0,variant:"link",className:"mt-4",children:(0,s.jsxs)(eL(),{href:"/",className:"flex items-center gap-2",children:[(0,s.jsx)(g,{size:16}),(0,s.jsx)("span",{children:u("dashboard.backToBuildings")})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[524,65,413,589,679,723,567,441,721,358],()=>t(3014)),_N_E=e.O()}]);